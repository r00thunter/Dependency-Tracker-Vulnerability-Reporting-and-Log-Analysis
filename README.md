
---

# Dependency Tracker Vulnerability Reporting and Log Analysis

This Flask application provides functionality for generating vulnerability reports, analyzing log files, and retrieving metrics from logs. It integrates with various APIs and provides a user-friendly web interface for interacting with the data.

## Features

- **Project Details and Vulnerability Reports**: Fetches project details and generates Excel reports for vulnerabilities.
- **Log File Parsing**: Parses log files and displays them in a readable format.
- **Metrics API**: Provides metrics about user activity and IP addresses from the logs.
- **Download Reports**: Allows users to download generated reports.

## Prerequisites

- Python 3.x
- Flask
- Pandas
- Requests
- openpyxl
- python-dotenv

## Installation

1. **Clone the repository:**

   ```bash
   git clone <repository-url>
   cd <repository-directory>
   ```

2. **Create a virtual environment:**

   ```bash
   python -m venv venv
   source venv/bin/activate  # On Windows, use `venv\Scripts\activate`
   ```

3. **Install the required packages:**

   ```bash
   pip install -r requirements.txt
   ```

4. **Create a `.env` file in the root directory with your API key:**

   ```env
   API_KEY=your_api_key_here
   ```

## Configuration

The `{{change_me}}` placeholders in your code are meant to be replaced with actual values. Here's a guide on what to replace them with:

1. **API Endpoint URL**

   For the `fetch_project_details` and `fetch_vulnerabilities` functions, replace `{{change_me}}` with the base URL of your API endpoint.

   ```python
   url = "http://{{change_me}}/endpoint/api/v1/project/"
   ```

   ```python
   url = f"http://{{change_me}}/endpoint/api/v1/finding/project/{project_id}"
   ```

   **Example:**

   ```python
   url = "https://api.yourdomain.com/endpoint/api/v1/project/"
   ```

   ```python
   url = f"https://api.yourdomain.com/endpoint/api/v1/finding/project/{project_id}"
   ```

2. **Log File Path**

   For the `parse_log_file`, `read_log_data`, and `get_metrics` functions, replace `{{change_me}}` with the directory path where your log file is stored.

   ```python
   log_file_path = '/{{change_me}}/dependency-track-audit.log'
   ```

   **Example:**

   ```python
   log_file_path = '/var/logs/dependency-track-audit.log'
   ```

## Running the Application

1. **Start the Flask server:**

   ```bash
   python app.py
   ```

2. **Access the application:**

   Open your web browser and go to `http://127.0.0.1:5000`.

## API Endpoints

- **GET /**: Displays the index page with project details.
- **GET /reports**: Displays the report generation page. (POST request required to generate a report.)
- **POST /reports**: Generates and downloads an Excel report based on the provided project ID and report name.
  
  **Request Parameters:**
  - `project_id`: The ID of the project to generate the report for.
  - `report_name`: The name of the report.

  **Response:**
  - Redirects to `/download/<filename>` if successful.

- **GET /logs**: Displays parsed log file content.
  
  **Log File Path:**
  - Adjust the log file path in the code to match your environment.

- **GET /server-logs**: Displays parsed new log file format.

  **Log File Path:**
  - Adjust the log file path in the code to match your environment.

- **GET /api/logs**: Returns log data in JSON format.
  
  **Response:**
  - A JSON object with log entries.

- **GET /api/metrics**: Returns metrics from the log data in JSON format.
  
  **Response:**
  - `usernames`: Top usernames based on log entries.
  - `successfulLogins`: Count of successful logins by username.
  - `unauthorizedAttempts`: Count of unauthorized login attempts by username.
  - `ipAddresses`: Top IP addresses based on log entries.

- **GET /download/<filename>**: Allows downloading of generated Excel reports.
  
  **Parameters:**
  - `filename`: Name of the Excel file to download.

## Functionality Details

### Fetching Project Details

The application fetches project details from a specified API endpoint using the provided API key.

### Generating Reports

Reports are generated in Excel format, showing details of vulnerabilities associated with a specific project. The generated file is available for download.

### Log Parsing

Logs are parsed from specified files using regular expressions. The logs are displayed in a user-friendly format, and metrics are computed based on log content.

**Example Log Format:**

```
2024-09-12 12:00:00,123 [INFO] INFO - User logged in / username: john_doe / IP Address: 192.168.1.1
```

### Metrics

The application provides metrics such as:
- **Top Usernames:** Most frequently occurring usernames in the logs.
- **Successful Logins:** Count of successful login attempts by each username.
- **Unauthorized Attempts:** Count of unauthorized login attempts by each username.
- **Top IP Addresses:** Most frequently occurring IP addresses in the logs.

## Environment Variables

- `API_KEY`: Your API key for accessing the vulnerability API.

## Error Handling

- If there are issues with fetching data from the API or generating reports, appropriate error messages are logged and displayed.

## Troubleshooting

- **Error fetching data from API**: Check your API key and endpoint URL.
- **Error generating report**: Ensure you have the required permissions to write to the reports directory.

## License

This project is licensed under the MIT License. See the [LICENSE](LICENSE) file for details.

---